@using AzureIoTHub.Portal.Models.v10
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication

@inject PortalSettings Portal
@inject SignOutSessionStateManager SignOutManager
@inject NavigationManager Navigation
@inject ILayoutService LayoutService

<MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@LayoutService.ToggleDrawer" />
<MudText Typo="Typo.h5">@Portal.PortalName</MudText>
<MudSpacer />
<AuthorizeView>
    <Authorized>
        <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <ActivatorContent>
                <MudAvatar Color="Color.Primary" Variant="Variant.Outlined">
                    <MudIcon Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Secondary" Size="Size.Medium" />
                </MudAvatar>
                <MudIconButton Icon="@Icons.Filled.KeyboardArrowDown" Color="Color.Secondary" Size="Size.Small" />
            </ActivatorContent>
            <ChildContent>
                <MudList Clickable="true">
                    <MudListSubheader>
                        <MudText Typo="Typo.caption">Signed in as</MudText>
                        <MudText Typo="Typo.body1"><b>@context.User.Identity.Name</b></MudText>
                    </MudListSubheader>
                    <MudDivider/>
                    <MudListItem Icon="@Icons.Material.Filled.Details">Details</MudListItem>
                    <MudListItem Href="#" OnClick="BeginLogout" Icon="@Icons.Material.Filled.Logout">Log out</MudListItem>
                </MudList>
            </ChildContent>
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <MudChip Icon="@Icons.Material.Filled.Login" Label="true" Color="Color.Secondary" Variant="Variant.Filled" @onclick="BeginLogin">Log in</MudChip>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task BeginLogout(MouseEventArgs args)
    {
        await SignOutManager.SetSignOutState();
        Navigation.NavigateTo("authentication/logout");
    }

    private void BeginLogin(MouseEventArgs args)
    {
        Navigation.NavigateTo("authentication/login");
    }
}
