@page "/devices/{DeviceId}"
@inherits AuthorizedComponentBase

@inject NavigationManager NavManager

<MudTooltip Text="Return" Placement="Placement.Left">
    <MudFab StartIcon="@Icons.Material.Outlined.ArrowBack" Color="Color.Secondary" Size="Size.Small" OnClick="Return" id="returnButton" />
</MudTooltip>
<MudTooltip Placement="Placement.Top">
    <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-4">  Device Details</MudText>
</MudTooltip>
<EditDevice Context="CreateEditMode.Edit" IsLoRa="@IsLoRa" DeviceId="@DeviceId" CanWrite="@canWrite" CanExec="@canExec" />

@code {
    protected override PortalPermissions[] RequiredPermissions { get; } = { PortalPermissions.DeviceRead };
    private bool canWrite;
    private bool canExec;

    [Parameter]
    [SupplyParameterFromQuery]
    public bool IsLoRa
    {
        get;
        set;
    }

    [Parameter]
    public string DeviceId { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        // Check if user has write permission for conditional UI elements
        canWrite = await HasPermissionAsync(PortalPermissions.DeviceWrite);
        canExec = await HasPermissionAsync(PortalPermissions.DeviceExecute);
    }

    private void Return() => NavManager.NavigateTo("devices");
}
