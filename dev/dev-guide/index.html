
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="IoT Hub Portal for device management" name="description"/>
<link href="../aws/" rel="prev"/>
<link href="testing/unit-tests-common-practices/" rel="next"/>
<link href="../assets/images/favicon.svg" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.2" name="generator"/>
<title>Developer Guide - IoT Hub Portal</title>
<link href="../assets/stylesheets/main.50c56a3b.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#developer-guide">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="IoT Hub Portal" class="md-header__button md-logo" data-md-component="logo" href=".." title="IoT Hub Portal">
<img alt="logo" src="../assets/images/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            IoT Hub Portal
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Developer Guide
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/CGI-FR/IoT-Hub-Portal" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    CGI-FR/IoT-Hub-Portal
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
    
  
  IoT Hub Portal

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../azure/">
        
  
    
  
  Azure

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../aws/">
        
  
    
  
  AWS

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
    
  
  Dev Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../concepts/">
        
  
    
  
  Concepts

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../open-api/">
        
  
    
  
  Web API Reference

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../about/issues/">
          
  
    
  
  About

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="IoT Hub Portal" class="md-nav__button md-logo" data-md-component="logo" href=".." title="IoT Hub Portal">
<img alt="logo" src="../assets/images/logo.svg"/>
</a>
    IoT Hub Portal
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/CGI-FR/IoT-Hub-Portal" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    CGI-FR/IoT-Hub-Portal
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    IoT Hub Portal
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../azure/">
<span class="md-ellipsis">
    Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../aws/">
<span class="md-ellipsis">
    AWS
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Dev Guide
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Dev Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Developer Guide
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Developer Guide
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#directory-structure">
<span class="md-ellipsis">
      Directory Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overall-architecture">
<span class="md-ellipsis">
      Overall Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#secrets">
<span class="md-ellipsis">
      Secrets
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#iot-hub-portal-configuration">
<span class="md-ellipsis">
      IoT Hub Portal Configuration
    </span>
</a>
<nav aria-label="IoT Hub Portal Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#application-settings">
<span class="md-ellipsis">
      Application settings
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connection-strings">
<span class="md-ellipsis">
      Connection strings
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optional-security-settings">
<span class="md-ellipsis">
      Optional Security Settings
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#device-tags">
<span class="md-ellipsis">
      Device tags
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-account">
<span class="md-ellipsis">
      Storage Account
    </span>
</a>
<nav aria-label="Storage Account" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#blob-storage">
<span class="md-ellipsis">
      Blob Storage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#working-with-the-documentation">
<span class="md-ellipsis">
      Working with the documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-update-the-documentation">
<span class="md-ellipsis">
      How to update the documentation
    </span>
</a>
<nav aria-label="How to update the documentation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#customization">
<span class="md-ellipsis">
      Customization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#versioning">
<span class="md-ellipsis">
      Versioning
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#problem-details">
<span class="md-ellipsis">
      Problem Details
    </span>
</a>
<nav aria-label="Problem Details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#handle-a-new-exception-using-problem-details">
<span class="md-ellipsis">
      Handle a new exception using Problem Details
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handle-problem-details-exceptions-on-frontend">
<span class="md-ellipsis">
      Handle Problem Details exceptions on frontend
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-install-entity-framework-core">
<span class="md-ellipsis">
      How to install Entity Framework Core
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-create-entityframework-migrations-for-postgresql-and-mysql">
<span class="md-ellipsis">
      How to create EntityFramework migrations for PostgreSQL and MySQL
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
<span class="md-ellipsis">
    Testing
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Testing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="testing/unit-tests-common-practices/">
<span class="md-ellipsis">
    Unit Tests Common Practices
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="testing/unit-tests-on-blazor-components/">
<span class="md-ellipsis">
    Unit Tests on Blazor components
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
<span class="md-ellipsis">
    Migrations
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            Migrations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="migrations/v3-to-v4/">
<span class="md-ellipsis">
    Migrate from v3 to v4
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="migrations/v4-to-v5/">
<span class="md-ellipsis">
    Migrate from v4 to v5
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
<span class="md-ellipsis">
    Project conception
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            Project conception
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="conception/diagrams/">
<span class="md-ellipsis">
    Diagrams
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../concepts/">
<span class="md-ellipsis">
    Concepts
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../open-api/">
<span class="md-ellipsis">
    Web API Reference
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-ellipsis">
    About
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            About
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../about/issues/">
<span class="md-ellipsis">
    Known Issues
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/support/">
<span class="md-ellipsis">
    Support
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/credits/">
<span class="md-ellipsis">
    Credits
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/license/">
<span class="md-ellipsis">
    License
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#directory-structure">
<span class="md-ellipsis">
      Directory Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overall-architecture">
<span class="md-ellipsis">
      Overall Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#secrets">
<span class="md-ellipsis">
      Secrets
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#iot-hub-portal-configuration">
<span class="md-ellipsis">
      IoT Hub Portal Configuration
    </span>
</a>
<nav aria-label="IoT Hub Portal Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#application-settings">
<span class="md-ellipsis">
      Application settings
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#connection-strings">
<span class="md-ellipsis">
      Connection strings
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#optional-security-settings">
<span class="md-ellipsis">
      Optional Security Settings
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#device-tags">
<span class="md-ellipsis">
      Device tags
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-account">
<span class="md-ellipsis">
      Storage Account
    </span>
</a>
<nav aria-label="Storage Account" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#blob-storage">
<span class="md-ellipsis">
      Blob Storage
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#working-with-the-documentation">
<span class="md-ellipsis">
      Working with the documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-update-the-documentation">
<span class="md-ellipsis">
      How to update the documentation
    </span>
</a>
<nav aria-label="How to update the documentation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#customization">
<span class="md-ellipsis">
      Customization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#versioning">
<span class="md-ellipsis">
      Versioning
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#problem-details">
<span class="md-ellipsis">
      Problem Details
    </span>
</a>
<nav aria-label="Problem Details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#handle-a-new-exception-using-problem-details">
<span class="md-ellipsis">
      Handle a new exception using Problem Details
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handle-problem-details-exceptions-on-frontend">
<span class="md-ellipsis">
      Handle Problem Details exceptions on frontend
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-install-entity-framework-core">
<span class="md-ellipsis">
      How to install Entity Framework Core
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-create-entityframework-migrations-for-postgresql-and-mysql">
<span class="md-ellipsis">
      How to create EntityFramework migrations for PostgreSQL and MySQL
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="developer-guide">Developer Guide<a class="headerlink" href="#developer-guide" title="Permanent link">¶</a></h1>
<h2 id="directory-structure">Directory Structure<a class="headerlink" href="#directory-structure" title="Permanent link">¶</a></h2>
<p>The code is organized into the following directory structure:</p>
<ul>
<li><strong>src</strong>: Source code</li>
<li><strong>AzureIoTHub.Portal.Server.Tests</strong>: Unit test project for the Portal</li>
<li><strong>AzureIoTHub.Portal</strong>: The Portal project<ul>
<li><strong>Client</strong>: .NET 6 Blazor Web Assembly project that alow to visualize the IoT Hub data</li>
<li><strong>Server</strong>: .NET 6 Web API project that provides the API for the Portal</li>
<li><strong>Shared</strong>: Shared code between the Client and Server projects</li>
</ul>
</li>
<li><strong>templates</strong>: contains the templates for the "deploy to Azure" button</li>
</ul>
<h2 id="overall-architecture">Overall Architecture<a class="headerlink" href="#overall-architecture" title="Permanent link">¶</a></h2>
<p>This schema represent the various components and how they interact to have a better understanding of the various solution elements.</p>
<p><img alt="images/overall-architecture.png" src="../images/overall-architecture.png"/></p>
<ol>
<li>The user is authenticated by the OpenID Connect server.</li>
<li>The user access to the IoT Hub Portal with the OAuth2.0 token.</li>
<li>The IoT Hub portal uses the Azure IoT Hub REST API to retrieve the data.</li>
<li>The IoT Hub portal uses the Azure Device Provisioning Service to manage IoT Edge devices.</li>
<li>The IoT Hub portal uses the Azure Storage account to store the device models configuration (Images, Commands, etc.).</li>
<li>The IoT Hub portal uses the LoRa Key Management Facade to send Cloud to Device (C2D) messages to LoRa devices.</li>
<li>The LoRa Key Management Facade uses Redis to store its cached data.</li>
<li>The LoRa Key Management Facade uses the Azure IoT Hub REST API to retrieve the LoRa device keys and send C2D messages.</li>
<li>The IoT Hub portal synchronizes its data with the IoT Hub to provide a consistent view of the data.</li>
</ol>
<blockquote>
<p>Note: For more information about the LoRa Key Management Facade, see the <a href="https://azure.github.io/iotedge-lorawan-starterkit">Azure IoT Edge LoRaWAN Starter Kit</a> page.</p>
</blockquote>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2>
<p>The following should be completed before proceeding with the IoT Hub Portal development or deployment in your environment.</p>
<p>Before getting started, it is better to master the tools below:</p>
<ul>
<li>Azure platform and Azure IoT Hub. A tutorial can be found <a href="https://docs.microsoft.com/en-us/learn/paths/ai-edge-engineer/">here</a>.</li>
<li>Blazor WebAssembly and Blazor Server. A traning is available <a href="https://docs.microsoft.com/en-us/learn/paths/build-web-apps-with-blazor/">on this site</a>.</li>
<li>Docker. An introduction to containerization is available <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/container-docker-introduction/">on this page</a>.</li>
<li>IoTEdge LoraWAN StarterKit. Have a look at <a href="https://azure.github.io/iotedge-lorawan-starterkit">LoRaWAN Starter Kit</a> to get more details on this OSS cross platform private network.</li>
</ul>
<hr/>
<p>Once you know the basics of these technologies and tools, you must follow these last steps to set up your working environment.</p>
<ul>
<li>IoT Hub Portal uses containers to work correctly. <a href="https://www.docker.com/">Docker</a> is required to launch this project (version &gt;= 4.11.1).</li>
</ul>
<blockquote>
<p>Once you have download Docker, you must install the WSL 2 Linux kernel. To do that, please refer to the official <a href="https://aka.ms/wsl2kernel">Microsoft documentation</a>. You can choose the linux distribution of your choice, for example Ubuntu.</p>
</blockquote>
<ul>
<li>Node.js is used to run JavaScript code in the portal. You can download the latest version <a href="https://nodejs.org/en/">here</a>.The minimal version required is 16.17.0.</li>
<li>You must have an Azure subscription. <a href="https://azure.microsoft.com/en-gb/free/">Get an Azure Free account to start</a>.</li>
<li>An Identity provider supporting OpenIDConnect protocol configured with 2 applications (API and web) is required to login to the IoT Hub Portal. See <a href="https://cgi-fr.github.io/IoT-Hub-Portal/stable/b2c-applications/">Azure AD B2C Tenant with applications</a> configuration page for example.</li>
<li>To develop, you can choose your own IDE or text editor, for example <a href="https://visualstudio.microsoft.com/">Visual Studio</a>.</li>
</ul>
<h3 id="secrets">Secrets<a class="headerlink" href="#secrets" title="Permanent link">¶</a></h3>
<p><em>Secrets</em> are used to fill in the login credentials to the cloud platform. You have to enter them in a <code>json</code> file to be able to connect to the IoT Hub Portal. Here is a template of a such <code>json</code> file :</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">"StorageAccount:ConnectionString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;CONNECTION_STRING_STORAGE_ACCOUNT&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nt">"StorageAccount:BlobContainerName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;BLOB_CONTAINER_NAME&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">"OIDC:Scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SCOPE&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="nt">"OIDC:MetadataUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;METADATA_URL&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="nt">"OIDC:ClientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;CLIENT_ID&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="nt">"OIDC:Authority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;AUTHORITY&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="nt">"OIDC:ApiClientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;API_CLIENT_ID&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="nt">"LoRaRegionRouterConfig:Url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;LORA_WAN_ROUTER_CONFIGURATION_URL&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="nt">"LoRaKeyManagement:Url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;LORA_WAN_KEY_MANAGEMENT_URL&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span><span class="nt">"LoRaKeyManagement:Code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;LORA_WAN_KEY_MANAGEMENT_CODE&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">  </span><span class="nt">"LoRaFeature:Enabled"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;TRUE_OR_FALSE&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span><span class="nt">"Kestrel:Certificates:Development:Password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;DEV_PASSWORD&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">  </span><span class="nt">"IoTHub:ConnectionString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;IOT_HUB_CONNECTION_STRING&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span><span class="nt">"IoTHub:EventHub:Endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;IOT_HUB_EVENT_HUB_ENDPOINT&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">  </span><span class="nt">"IoTHub:EventHub:ConsumerGroup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;IOT_HUB_EVENT_HUB_CONSUMER_GROUP&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">  </span><span class="nt">"IoTDPS:ServiceEndpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SERVICE_END_POINT&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">  </span><span class="nt">"IoTDPS:LoRaEnrollmentGroup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;LORA_WAN_ENROLLMENT_GROUP&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">  </span><span class="nt">"IoTDPS:DefaultEnrollmentGroup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;LORA_WAN_DEFAULT_ENROLLMENT_GROUP&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">  </span><span class="nt">"IoTDPS:ConnectionString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;IOT_DPS_CONNECTION_STRING&gt;"</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">  </span><span class="nt">"PostgreSQL:ConnectionString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;POSTGRE_SQL_CONNECTION_STRING&gt;"</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><u>Note:</u> You must replace all values in the brackets by your own Azure settings. If you can't find them in the Azure Portal, please contact an administrator of this project to have more information.</p>
</blockquote>
<p>This <code>json</code> file must be added into your project solution. To do that, click on the <code>AzureIoTHub.Server</code> project in Visual Studio and select <code>Manage User Secrets</code> from the context menu. You can now add your secrets inside this file.</p>
<p>You are now ready to start your IoT Hub Portal development !</p>
<h2 id="iot-hub-portal-configuration">IoT Hub Portal Configuration<a class="headerlink" href="#iot-hub-portal-configuration" title="Permanent link">¶</a></h2>
<p>By deploying the IoT Hub Portal, the user can configure the IoT Hub and the LoRaWAN network.</p>
<p>Since the IoT Hub Portal is deployed as a Docker container, the application settings can be configured with environment variables.</p>
<h3 id="application-settings">Application settings<a class="headerlink" href="#application-settings" title="Permanent link">¶</a></h3>
<p>Here are different settings that the user can configure:</p>
<ul>
<li><strong>PortalName</strong>: The name of the portal (shown in the App Bar and the Page Title).</li>
<li><strong>OIDC__Authority</strong>: The OpenID Connect issuer.</li>
<li><strong>OIDC__MetadataUrl</strong>: The OpenID Connect metadata URL (e.g. <code>.well-known/openid-configuration</code>).</li>
<li><strong>OIDC__ClientId</strong>: The OpenID Connect client ID for the Web UI.</li>
<li><strong>OIDC__ApiClientId</strong>: The OpenID Connect client ID for the API.</li>
<li><strong>OIDC__Scope</strong>: The OpenID Connect scope that represents the portal API.</li>
<li><strong>IoTDPS__ServiceEndpoint</strong>: The IoT Device Provisioning Service endpoint.</li>
<li><strong>IoTDPS__IDScope</strong>: The IoT Device Provisioning Service ID scope.</li>
<li><strong>LoRaFeature__Enabled</strong>: Whether the LoRaWAN feature is enabled or not.</li>
<li><strong>LoRaKeyManagement__Url</strong>: The LoRa Key Management Facade URL.</li>
<li><strong>StorageAccount__BlobContainerName</strong>: The name of the Azure Storage container where the device models images are stored.</li>
<li><strong>IoTHub__EventHub__Endpoint</strong>: The IotHub Event Hub compatible endpoint.</li>
<li><strong>IoTHub__EventHub__ConsumerGroup</strong>: (Default value <code>iothub-portal</code>) The name of the consumer group used to to pull data from the IoT Hub (Automatically created by the Bicep/ARM deployement)</li>
<li><strong>ASPNETCORE_ENVIRONMENT</strong>: Built-in environment variable, used to target the configuration provided by a specific environment. Two accepted values:</li>
<li><code>Development</code>: On this environment, logs are produced up to <code>Debug</code> level.</li>
<li><code>Production</code>: Default value if ASPNETCORE_ENVIRONMENT is not set. On this environment, logs are produced up to <code>Information</code> level.</li>
<li><strong>Metrics__ExporterRefreshIntervalInSeconds</strong>: (Optional, default value <code>30</code>) The refresh interval in <code>seconds</code> to collect custom metrics and expose them to the exporter endpoint.</li>
<li><strong>Metrics__LoaderRefreshIntervalInMinutes</strong>: (Optional, default value <code>10</code>) The refresh interval in <code>minutes</code> to calculate/refresh custom metrics values.</li>
<li><strong>Ideas__Enabled</strong>: (Optional, default value <code>false</code>) To enable Ideas feature when set to <code>true</code>.</li>
<li><strong>Ideas__Url</strong>: Url of <code>Awesome-Ideas</code>, to publish ideas submitted by users.</li>
<li><strong>Ideas__Authentication__Header</strong>: (Optional, default value <code>Ocp-Apim-Subscription-Key</code>) Authentication header name.</li>
<li><strong>Ideas__Authentication__Token</strong>: Authentication token.</li>
<li><strong>Job__SyncDatabaseJobRefreshIntervalInMinutes</strong>: (Optional, default value <code>5</code>) The refresh interval in <code>minutes</code> to collect data from Azure IoT Hub (Devices, Iot Edge Devices...) and store them on the database of the Portal.</li>
</ul>
<h3 id="connection-strings">Connection strings<a class="headerlink" href="#connection-strings" title="Permanent link">¶</a></h3>
<p>Here are different connection strings that the user can configure:</p>
<ul>
<li><strong>IoTHub__ConnectionString</strong>: The connection string to the IoT Hub.</li>
<li><strong>IoTDPS__ConnectionString</strong>: The connection string to the Azure IoT Device Provisioning Service.</li>
<li><strong>StorageAccount__ConnectionString</strong>: The connection string to the Azure Storage account.</li>
<li><strong>LoRaKeyManagement__Code</strong>: The LoRa Key Management Facade code.</li>
<li><strong>PostgreSQL__ConnectionString</strong>: The connection string allowing the connection to the PostgreSQL database.</li>
</ul>
<blockquote>
<p>Note: For a production environment, an Azure Key Vault is advised to store the connection strings.</p>
</blockquote>
<h3 id="optional-security-settings">Optional Security Settings<a class="headerlink" href="#optional-security-settings" title="Permanent link">¶</a></h3>
<p>There are several optional security settings that the user can configure. These settings are not required for the Portal to work. By default the Portal is configured to set security levels to <code>Microsoft.IdentityModel.Tokens</code> defaults but the user can override these settings.</p>
<ul>
<li>UseSecurityHeaders<blockquote>
<p>This boolean adds the following headers to all responses :</p>
<p><code>X-Content-Type-Options: nosniff</code></p>
<p><code>Strict-Transport-Security: max-age=31536000; includeSubDomains</code> - <em>only applied to HTTPS responses</em></p>
<p><code>X-Frame-Options: Deny</code> - <em>only applied to text/html responses</em></p>
<p><code>X-XSS-Protection: 1; mode=block</code> - <em>only applied to text/html responses</em></p>
<p><code>Referrer-Policy: strict-origin-when-cross-origin</code> - <em>only applied to text/html responses</em></p>
<p><code>Content-Security-Policy: object-src 'none'; form-action 'self'; frame-ancestors 'none'</code> - <em>only applied to text/html responses</em>.</p>
<p>The <strong>default is true</strong>.</p>
</blockquote>
</li>
<li>OIDC__ValidateIssuer<blockquote>
<p>Validation of the issuer mitigates forwarding attacks that can occur when an IdentityProvider represents multiple tenants and signs tokens with the same keys. It is possible that a token issued for the same audience could be from a different tenant. For example an application could accept users from contoso.onmicrosoft.com but not fabrikam.onmicrosoft.com, both valid tenants. An application that accepts tokens from fabrikam could forward them to the application that accepts tokens for contoso. This boolean only applies to default issuer validation. If <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters.issuervalidator?view=azure-dotnet#microsoft-identitymodel-tokens-tokenvalidationparameters-issuervalidator">IssuerValidator</a> is set, it will be called regardless of whether this property is true or false.</p>
<p>The <strong>default is true</strong>.</p>
</blockquote>
</li>
<li>OIDC__ValidateAudience<blockquote>
<p>Validation of the audience, mitigates forwarding attacks. For example, a site that receives a token, could not replay it to another side. A forwarded token would contain the audience of the original site. This boolean only applies to default audience validation. If <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters.audiencevalidator?view=azure-dotnet#microsoft-identitymodel-tokens-tokenvalidationparameters-audiencevalidator">AudienceValidator</a> is set, it will be called regardless of whether this property is true or false.</p>
<p>The <strong>default is true</strong>.</p>
</blockquote>
</li>
<li>OIDC__ValidateLifetime<blockquote>
<p>This boolean only applies to default lifetime validation. If <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters.lifetimevalidator?view=azure-dotnet#microsoft-identitymodel-tokens-tokenvalidationparameters-lifetimevalidator">LifetimeValidator</a> is set, it will be called regardless of whether this property is true or false.</p>
<p>The <strong>default is true</strong>.</p>
</blockquote>
</li>
<li>OIDC__ValidateIssuerSigningKey<blockquote>
<p>It is possible for tokens to contain the public key needed to check the signature. For example, X509Data can be hydrated into an X509Certificate, which can be used to validate the signature. In these cases it is important to validate the SigningKey that was used to validate the signature. This boolean only applies to default signing key validation. If <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters.issuersigningkeyvalidator?view=azure-dotnet#microsoft-identitymodel-tokens-tokenvalidationparameters-issuersigningkeyvalidator">IssuerSigningKeyValidator</a> is set, it will be called regardless of whether this property is true or false.</p>
<p>The <strong>default is false</strong>.</p>
</blockquote>
</li>
<li>OIDC_ValidateActor<blockquote>
<p>If an actor token is detected, whether it should be validated.</p>
<p>The <strong>default is false</strong>.</p>
</blockquote>
</li>
<li>OIDC_ValidateTokenReplay<blockquote>
<p>This boolean only applies to default token replay validation. If <a href="https://docs.microsoft.com/fr-fr/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters.tokenreplayvalidator?view=azure-dotnet#microsoft-identitymodel-tokens-tokenvalidationparameters-tokenreplayvalidator">TokenReplayValidator</a> is set, it will be called regardless of whether this property is true or false.</p>
<p>The <strong>default is false</strong>.</p>
</blockquote>
</li>
</ul>
<h2 id="device-tags">Device tags<a class="headerlink" href="#device-tags" title="Permanent link">¶</a></h2>
<p>The IoT Hub portal uses some tags to configure the devices. The tags are stored in the Azure IoT Hub in Device Twins.</p>
<ul>
<li><strong>modelId</strong>: The device model ID that is used to retrieve the device model configuration.</li>
</ul>
<h2 id="storage-account">Storage Account<a class="headerlink" href="#storage-account" title="Permanent link">¶</a></h2>
<p>The Storage Account is used to store the device models images. You can use the same Storage Account that is used by the LoRa Key Management Facade.
This solution will use tables and blob storage to store its data. There is no need to create the containers, the application will do it for you.</p>
<h3 id="blob-storage">Blob Storage<a class="headerlink" href="#blob-storage" title="Permanent link">¶</a></h3>
<p>The application uses the following blob storage:</p>
<ul>
<li><strong>device-images</strong>: The blob storage that contains the device images.</li>
</ul>
<h2 id="working-with-the-documentation">Working with the documentation<a class="headerlink" href="#working-with-the-documentation" title="Permanent link">¶</a></h2>
<p>This documentation site is build using <a href="https://github.com/squidfunk/mkdocs-material">Material for MkDocs</a> and <a href="https://github.com/jimporter/mike">Mike</a>.</p>
<p><code>docs/main</code> is a detached branch that is locked and only accepts PRs. On PR merge, Github Pages will automatically update the documentation website.</p>
<h2 id="how-to-update-the-documentation">How to update the documentation<a class="headerlink" href="#how-to-update-the-documentation" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>Checkout the branch that contains the documentation:</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="go">git checkout origin/docs/main</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="go">git checkout -b docs/&lt;your_branch_name&gt; </span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Install dependencies</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="go">pip install -r requirements.txt</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Previewing as you write</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="go">mkdocs serve</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>PRs are gated by a markdownlint check. You should use markdownlint to lint any new changes on documentation. For example you can use the vs code extension <a href="https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint">https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint</a></p>
</li>
<li>Update the documentation</li>
<li>Commit your changes</li>
<li>Push your changes to the branch</li>
<li>Create a PR</li>
</ol>
<h3 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">¶</a></h3>
<p>Refer to Material for MkDocs documentations:</p>
<ul>
<li><a href="https://squidfunk.github.io/mkdocs-material/customization/">https://squidfunk.github.io/mkdocs-material/customization</a></li>
<li><a href="https://squidfunk.github.io/mkdocs-material/setup">https://squidfunk.github.io/mkdocs-material/setup</a></li>
</ul>
<h3 id="versioning">Versioning<a class="headerlink" href="#versioning" title="Permanent link">¶</a></h3>
<p><a href="https://github.com/jimporter/mike">Mike</a> is used to generate automatically a new documentation version when a release has been published, using ci/cd pipelines.</p>
<p>For manual workflows (e.g. delete or retitle an existing version), please refer to <a href="https://github.com/jimporter/mike">Mike documentation</a></p>
<h2 id="problem-details">Problem Details<a class="headerlink" href="#problem-details" title="Permanent link">¶</a></h2>
<p>On IoT Hub Portal, we use the library <a href="https://github.com/khellang/Middleware">Hellang.Middleware.ProblemDetails</a> which implements <a href="https://datatracker.ietf.org/doc/html/rfc7807">RFC7807</a> to describe issues/problems that occurred on backend.</p>
<h3 id="handle-a-new-exception-using-problem-details">Handle a new exception using <code>Problem Details</code><a class="headerlink" href="#handle-a-new-exception-using-problem-details" title="Permanent link">¶</a></h3>
<ul>
<li>Create a new exception which extends <a href="https://github.com/CGI-FR/IoT-Hub-Portal/blob/main/src/AzureIoTHub.Portal/Server/Exceptions/BaseException.cs"><code>BaseException</code></a>. For example see 👉 <a href="https://github.com/CGI-FR/IoT-Hub-Portal/blob/main/src/AzureIoTHub.Portal/Server/Exceptions/InternalServerErrorException.cs"><code>InternalServerErrorException</code></a></li>
<li>On <a href="https://github.com/CGI-FR/IoT-Hub-Portal/blob/main/src/AzureIoTHub.Portal/Server/Startup.cs">Startup</a> class, within the instruction <code>services.AddProblemDetails()</code>:
    &gt; Your new exception is already catched by the middleware Problem Details because its extends the exception <code>BaseException</code>.
    &gt; If you want override the behavior of the middleware when processing your exception, you have to add a new mapping within it.</li>
</ul>
<blockquote>
<p>💡 You can also map exceptions from dotnet framework and third parties.</p>
</blockquote>
<h3 id="handle-problem-details-exceptions-on-frontend">Handle <code>Problem Details</code> exceptions on frontend<a class="headerlink" href="#handle-problem-details-exceptions-on-frontend" title="Permanent link">¶</a></h3>
<p>On frontend, http client uses a delegating handler <a href="https://github.com/CGI-FR/IoT-Hub-Portal/blob/main/src/AzureIoTHub.Portal/Client/Handlers/ProblemDetailsHandler.cs">ProblemDetailsHandler</a> to:</p>
<ul>
<li>Execute the http request and wait the response</li>
<li>If the response is not successful:</li>
<li>The body of the response is deserialized to <code>ProblemDetailsWithExceptionDetails</code></li>
<li>An exception with type <code>ProblemDetailsException</code> (including the error response) is thrown.</li>
</ul>
<p>On Blazor views, http calls must be catched to capture any exceptions of type <code>ProblemDetailsException</code> to be able to execute any business code to process them.</p>
<p>When an http call fails, the user must be notified visually by the application: A component <a href="https://github.com/CGI-FR/IoT-Hub-Portal/blob/main/src/AzureIoTHub.Portal/Client/Shared/NavMenu.razor">Error</a> has been made to respond to this use case.
Below an example on how to:</p>
<ul>
<li>Catch an ProblemDetailsException when making a http call</li>
<li>Delegate the exception to the <code>Error</code> component, so that it can visually warn the user</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C#</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">@code</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="c1">// Inject the reference to the Error component as a cascading parameter</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="na">[CascadingParameter]</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">GetData</span><span class="p">()</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">        </span><span class="k">try</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">            </span><span class="c1">// Execute an http request</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProblemDetailsException</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">            </span><span class="c1">// Pass the ProblemDetailsException exception to Error component using its method ProcessProblemDetails()</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">            </span><span class="c1">// The Error component will alert the user by showing a (snackbar/dialog) using the content of the exception</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">            </span><span class="n">Error</span><span class="o">?.</span><span class="n">ProcessProblemDetails</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="how-to-install-entity-framework-core">How to install Entity Framework Core<a class="headerlink" href="#how-to-install-entity-framework-core" title="Permanent link">¶</a></h2>
<p>Follow the next step to install EF Core:</p>
<ol>
<li>
<p>Open the terminal and run this command:</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="go">dotnet tool install --global dotnet-ef</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h2 id="how-to-create-entityframework-migrations-for-postgresql-and-mysql">How to create EntityFramework migrations for PostgreSQL and MySQL<a class="headerlink" href="#how-to-create-entityframework-migrations-for-postgresql-and-mysql" title="Permanent link">¶</a></h2>
<p>For the project need, we need two database providers which are PostgreSQL and MySQL, which led us to review the architecture set up for the EntityFramework migrations. Here is a diagram showing the two architectures.</p>
<pre class="mermaid"><code>C4Deployment
  title Architecture for multiple providers

  Deployment_Node(provider1, "Provider1", "Provider1"){
    Container(provider1dbcontextfactory, "Provider1DbContextFactory", "File", "")
    Container(provider1migrations, "Provider1Migrations", "Folder", "")
  }

  Deployment_Node(provider2, "Provider2", "Provider2"){
    Container(provider2dbcontextfactory, "Provider2DbContextFactory", "File", "")
    Container(provider2migrations, "Provider2Migrations", "Folder", "")
  }

  Deployment_Node(dal, "Infrastructure Layer", "Dal"){
    Container(dbcontext, "DbContext", File, "")
  }

  Rel(provider1dbcontextfactory, dbcontext, "dependency", "")
  Rel(provider2dbcontextfactory, dbcontext, "dependency", "")</code></pre>
<p>Follow the next steps to create EF migration:</p>
<ol>
<li>
<p>Go into the Server project folder with terminal</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="go">cd .\IoTHub.Portal.Server\</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Execute this command for PostgreSQL provider</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="go">dotnet ef migrations add "&lt;nameofyourmigration&gt;" -p ..\IoTHub.Portal.Postgres\ -v -- --DbProvider PostgreSQL</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Execute this command for MySQL provider</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Bash Session</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="go">dotnet ef migrations add "&lt;nameofyourmigration&gt;" -p ..\IoTHub.Portal.MySql\ -v -- --DbProvider MySQL</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Open the created migration and follow the following steps:</p>
<ol>
<li>
<p>Move the using directive into the namespace directive</p>
</li>
<li>
<p>Add "_ =" before each statement of the Up and Down methods</p>
</li>
<li>
<p>Add the CGI copyright to the top of the file</p>
</li>
</ol>
</li>
</ol>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2022 CGI France
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>