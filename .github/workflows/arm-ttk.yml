name: Validate ARM templates

on:
  pull_request:
    branches: [ master ]
    paths:
      - 'templates/**'
  push:
    branches: [ master ]
    paths:
      - 'templates/**'
  schedule:
    #        ┌───────────── minute (0 - 59)
    #        │  ┌───────────── hour (0 - 23)
    #        │  │ ┌───────────── day of the month (1 - 31)
    #        │  │ │ ┌───────────── month (1 - 12 or JAN-DEC)
    #        │  │ │ │ ┌───────────── day of the week (0 - 6 or SUN-SAT)
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        *  * * * *
    - cron: '30 1 * * *'
  workflow_dispatch:

jobs:
  validate_arm_templates:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3

      - name: Checkout Azure/arm-ttk
        uses: actions/checkout@v3
        with: 
          repository: Azure/arm-ttk
          path: arm-ttk
      
      - name: Run arm-ttk
        shell: pwsh
        run: |
          Import-Module ./arm-ttk/arm-ttk/arm-ttk.psd1
          Test-AzTemplate -TemplatePath ./templates
